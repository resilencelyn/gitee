<?xml version="1.0"?>
<!DOCTYPE mycat:encrypt SYSTEM "encrypt.dtd">
<mycat:encrypt xmlns:mycat="http://io.mycat/">

    <!--auto 属性目前只适用于 mysql 数据库 auto为1程序启动的时候将自动对配置的字段加密-->
    <!--解析小于等于以下复杂度sql基本是没问题的，如果被加密的字段起别名了，目前不支持，常用的 sql 足够了，如果遇到查询条件不能正常加密的，可以在程序中控制一下，但应该是极少数

    SELECT * FROM (SELECT p.people_id,p.name,p.card_type,p.card_code,p.phone,api.check_status,api.acid_people_info_id
	FROM real_people p LEFT JOIN real_people p1 ON p.people_id=p1.people_id JOIN
	std_door d ON p.door_id = d.door_id LEFT JOIN std_building b ON d.building_id = b.building_id
	LEFT JOIN acid_people_info api ON p.card_code = api.card_code AND api.check_round=1 JOIN cmn_grid g ON p.grid_code = g.grid_code
	WHERE p.people_id IN
	(SELECT people_id FROM (SELECT MAX(p.people_id) people_id FROM real_people p LEFT JOIN acid_people_info api ON p.card_code = api.card_code AND api.check_round=1 JOIN cmn_grid g ON p.grid_code=g.grid_code WHERE p.change_type='0' AND p.card_code like '123' GROUP BY p.card_code UNION ALL SELECT people_id FROM real_people p JOIN cmn_grid g ON p.grid_code=g.grid_code WHERE change_type='0' AND p.card_code IN ('123') )t)) t1
     -->

    <!--加密的此处的 schema 对应 schema.xml 中的schema schema保持唯一，不能重复-->
    <server schema="test">
        <datasource name="test" ip="localhost" port="3307" username="root" password="root" auto="1" dbType="mysql">
            <!--被加密的字段需要是字符串类型-->
            <column name="card_code">
                <table name="real_people_copy1" pk="people_id"/>
            </column>
            <column name="name">
                <table name="real_people_copy1" pk="people_id"/>
            </column>
        </datasource>
    </server>
</mycat:encrypt>
