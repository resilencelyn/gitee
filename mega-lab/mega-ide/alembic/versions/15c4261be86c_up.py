"""up

Revision ID: 15c4261be86c
Revises: 
Create Date: 2022-02-23 10:58:49.419198

"""
from alembic import op
import sqlalchemy as sa
import sqlalchemy_utils


# revision identifiers, used by Alembic.
revision = '15c4261be86c'
down_revision = None
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('ide_environment',
    sa.Column('created', sa.DateTime(), nullable=False),
    sa.Column('updated', sa.DateTime(), nullable=False),
    sa.Column('id', sqlalchemy_utils.types.uuid.UUIDType(binary=False), nullable=False),
    sa.Column('name', sa.String(length=256), nullable=False, comment='环境名称'),
    sa.Column('max_cpu', sa.Integer(), nullable=False, comment='最大可用CPU数量'),
    sa.Column('max_memory', sa.Integer(), nullable=False, comment='最大可用内存(G)'),
    sa.Column('max_disk', sa.Integer(), nullable=False, comment='最大可用硬盘(G)'),
    sa.Column('status', sa.Integer(), nullable=False, comment='是否启用(0:否,1:是)'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name')
    )
    op.create_index(op.f('ix_ide_environment_id'), 'ide_environment', ['id'], unique=False)
    op.create_table('ide_registry',
    sa.Column('created', sa.DateTime(), nullable=False),
    sa.Column('updated', sa.DateTime(), nullable=False),
    sa.Column('id', sqlalchemy_utils.types.uuid.UUIDType(binary=False), nullable=False),
    sa.Column('name', sa.String(length=256), nullable=False, comment='镜像源名称'),
    sa.Column('registry', sa.String(length=256), nullable=False, comment='镜像源地址'),
    sa.Column('enable', sa.Integer(), nullable=False, comment='是否启用镜像源(0:禁用,1:启用,2:镜像源不可达)'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name')
    )
    op.create_index(op.f('ix_ide_registry_id'), 'ide_registry', ['id'], unique=False)
    op.create_table('ide_image',
    sa.Column('created', sa.DateTime(), nullable=False),
    sa.Column('updated', sa.DateTime(), nullable=False),
    sa.Column('id', sqlalchemy_utils.types.uuid.UUIDType(binary=False), nullable=False),
    sa.Column('name', sa.String(length=256), nullable=False, comment='镜像名'),
    sa.Column('version', sa.String(length=256), nullable=False, comment='镜像版本'),
    sa.Column('git_url', sa.String(length=256), nullable=True, comment='镜像的Git地址'),
    sa.Column('note', sa.String(length=256), nullable=True, comment='镜像简介'),
    sa.Column('status', sa.Integer(), nullable=False, comment='镜像状态(0:未构建,1:构建中,2:构建失败,3:构建成功)'),
    sa.Column('job_id', sa.String(length=256), nullable=True, comment='构建任务id'),
    sa.Column('ide_registry_id', sqlalchemy_utils.types.uuid.UUIDType(binary=False), nullable=True, comment='镜像源ID'),
    sa.Column('ide_type', sa.Integer(), nullable=True, comment='IDE镜像类型(0:jupyter,1:vscode)'),
    sa.ForeignKeyConstraint(['ide_registry_id'], ['ide_registry.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name', 'ide_registry_id', name='name_ide_registry_id')
    )
    op.create_index(op.f('ix_ide_image_id'), 'ide_image', ['id'], unique=False)
    op.create_table('ide',
    sa.Column('created', sa.DateTime(), nullable=False),
    sa.Column('updated', sa.DateTime(), nullable=False),
    sa.Column('id', sqlalchemy_utils.types.uuid.UUIDType(binary=False), nullable=False),
    sa.Column('name', sa.String(length=256), nullable=False, comment='IDE名称'),
    sa.Column('create_user_id', sa.String(length=256), nullable=True, comment='创建用户ID'),
    sa.Column('create_user_name', sa.String(length=256), nullable=True, comment='创建用户名称'),
    sa.Column('ide_environment_id', sqlalchemy_utils.types.uuid.UUIDType(binary=False), nullable=True),
    sa.Column('ide_image_id', sqlalchemy_utils.types.uuid.UUIDType(binary=False), nullable=True),
    sa.Column('status', sa.Integer(), nullable=True, comment='当前状态(0:未运行,1:启动中,2:运行,3:暂停中)'),
    sa.ForeignKeyConstraint(['ide_environment_id'], ['ide_environment.id'], ),
    sa.ForeignKeyConstraint(['ide_image_id'], ['ide_image.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name', 'ide_environment_id', name='name')
    )
    op.create_index(op.f('ix_ide_id'), 'ide', ['id'], unique=False)
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_ide_id'), table_name='ide')
    op.drop_table('ide')
    op.drop_index(op.f('ix_ide_image_id'), table_name='ide_image')
    op.drop_table('ide_image')
    op.drop_index(op.f('ix_ide_registry_id'), table_name='ide_registry')
    op.drop_table('ide_registry')
    op.drop_index(op.f('ix_ide_environment_id'), table_name='ide_environment')
    op.drop_table('ide_environment')
    # ### end Alembic commands ###
