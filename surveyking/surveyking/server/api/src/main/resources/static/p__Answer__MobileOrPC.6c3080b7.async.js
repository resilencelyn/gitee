(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[1835],{36432:function(De,T,s){"use strict";s.r(T),s.d(T,{MobileOrPC:function(){return B},default:function(){return ne}});var Me=s(57106),$=s(99683),Be=s(57338),z=s(25084),Ee=s(71194),A=s(50146),Fe=s(57663),w=s(71577),be=s(9715),Z=s(93766),ke=s(47673),V=s(4107),C=s(2824),H=s(51615),d=s(67294),y=s(28991),J={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM540 701v53c0 4.4-3.6 8-8 8h-40c-4.4 0-8-3.6-8-8v-53a48.01 48.01 0 1156 0zm152-237H332V240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224z"}}]},name:"lock",theme:"filled"},U=J,I=s(27029),D=function(a,r){return d.createElement(I.Z,(0,y.Z)((0,y.Z)({},a),{},{ref:r,icon:U}))};D.displayName="LockFilled";var G=d.forwardRef(D),K={icon:function(a,r){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M81.8 537.8a60.3 60.3 0 010-51.5C176.6 286.5 319.8 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c-192.1 0-335.4-100.5-430.2-300.2z",fill:r}},{tag:"path",attrs:{d:"M512 258c-161.3 0-279.4 81.8-362.7 254C232.6 684.2 350.7 766 512 766c161.4 0 279.5-81.8 362.7-254C791.4 339.8 673.3 258 512 258zm-4 430c-97.2 0-176-78.8-176-176s78.8-176 176-176 176 78.8 176 176-78.8 176-176 176z",fill:r}},{tag:"path",attrs:{d:"M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258s279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766z",fill:a}},{tag:"path",attrs:{d:"M508 336c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z",fill:a}}]}},name:"eye",theme:"twotone"},Q=K,M=function(a,r){return d.createElement(I.Z,(0,y.Z)((0,y.Z)({},a),{},{ref:r,icon:Q}))};M.displayName="EyeTwoTone";var W=d.forwardRef(M),X=s(88633),Y=s(2299),x=s(87998),q=s(92725),O=s(14247),_=s(7354),Re=s(72487),j=s(3182),ee=s(69610),re=s(54941),te=s(94043),g=s.n(te),S=s(68489),n=s(54531),se=function(){function h(a){(0,ee.Z)(this,h),this.id=void 0,this.project=void 0,this.survey=void 0,this.loading=void 0,this.verifying=!1,this.saving=!1,this.isPC=void 0,this.startTime=void 0,this.errorCode=void 0,this.errorMessage=void 0,this.progress=0,this.id=a,this.makeObservable(),this.loadProject(),this.startTime=new Date().getTime()}return(0,re.Z)(h,[{key:"makeObservable",value:function(){(0,n.Ou)(this,{id:n.LO.ref,survey:n.LO.ref,loading:n.LO.ref,saving:n.LO.ref,verifying:n.LO.ref,project:n.LO.ref,errorCode:n.LO.ref,errorMessage:n.LO.ref,progress:n.LO.ref,passwordRequired:n.LO.computed,loginRequired:n.LO.computed,tempSaveId:n.LO.computed,savedAnswer:n.LO.computed,status:n.LO.computed,setting:n.LO.computed,tempSave:n.aD,saveData:n.aD,loadProject:n.aD,verifyPassword:n.aD,changeProgress:n.aD})}},{key:"setting",get:function(){var r;return(r=this.project)===null||r===void 0?void 0:r.setting}},{key:"status",get:function(){var r;return(r=this.project)===null||r===void 0?void 0:r.status}},{key:"passwordRequired",get:function(){var r;return(r=this.project)===null||r===void 0?void 0:r.passwordRequired}},{key:"loginRequired",get:function(){var r;return(r=this.project)===null||r===void 0?void 0:r.loginRequired}},{key:"tempSaveId",get:function(){return"savedAnswer-"+this.id}},{key:"savedAnswer",get:function(){var r=localStorage.getItem(this.tempSaveId);return r&&JSON.parse(r)}},{key:"tempSave",value:function(r){var l=localStorage.getItem(this.tempSaveId),e;l?(e=JSON.parse(l),e.answer=r):e={answer:r,metaInfo:{answerInfo:{startTime:new Date().getTime()}}},localStorage.setItem(this.tempSaveId,JSON.stringify(e))}},{key:"saveData",value:function(){var a=(0,j.Z)(g().mark(function l(e){var v;return g().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return this.saving=!0,v={answer:e,projectId:this.id,metaInfo:{answerInfo:{startTime:this.startTime,endTime:new Date().getTime()}}},i.next=4,S.hi.post("/api/public/saveAnswer",v);case 4:localStorage.removeItem(this.tempSaveId),this.saving=!1;case 6:case"end":return i.stop()}},l,this)}));function r(l){return a.apply(this,arguments)}return r}()},{key:"loadProject",value:function(){var a=(0,j.Z)(g().mark(function l(){var e;return g().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.loading=!0,c.next=3,S.hi.post("/api/public/loadProject",{id:this.id});case 3:e=c.sent,e.success?(this.project=e.data,this.survey=e.data.survey):this.errorMessage=e.message,this.errorCode=e.code,this.loading=!1;case 7:case"end":return c.stop()}},l,this)}));function r(){return a.apply(this,arguments)}return r}()},{key:"verifyPassword",value:function(){var a=(0,j.Z)(g().mark(function l(e){var v;return g().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return this.verifying=!0,i.next=3,S.hi.post("/api/public/verifyPassword",{id:this.id,password:e});case 3:if(v=i.sent,this.verifying=!1,v.code!==200){i.next=8;break}return this.survey=v.data.survey,i.abrupt("return",!0);case 8:return i.abrupt("return",!1);case 9:case"end":return i.stop()}},l,this)}));function r(l){return a.apply(this,arguments)}return r}()},{key:"upload",value:function(){var a=(0,j.Z)(g().mark(function l(e,v){return g().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",S.hi.upload("/api/public/upload",{file:e},v));case 1:case"end":return i.stop()}},l)}));function r(l,e){return a.apply(this,arguments)}return r}()},{key:"changeProgress",value:function(r){this.progress=r}}]),h}(),ae=s(19319),t=s(85893),B=(0,Y.Pi)(function(){var h,a,r=(0,H.UO)(),l=r.id,e=(0,d.useMemo)(function(){return new se(l)},[l]),v=(0,d.useState)(!1),c=(0,C.Z)(v,2),i=c[0],ie=c[1],P=(0,d.useMemo)(function(){return(0,x.SB)()},[]),oe=(0,d.useRef)(null),le=e.saving,ue=e.loading,de=(h=e.setting)===null||h===void 0?void 0:h.answerSetting,p=de||{},ve=p.autoSave,L=p.progressBar,ce=p.initialValues,fe=p.questionNumber,he=p.wechatOnly,ge=(a=e.setting)===null||a===void 0?void 0:a.submittedSetting,me=ge||{},E=me.contentHtml,Ne=e.errorCode,pe=e.errorMessage,ye=e.progress,je=(0,d.useState)(),F=(0,C.Z)(je,2),b=F[0],Se=F[1],we=(0,d.useState)({}),k=(0,C.Z)(we,2),R=k[0],Ce=k[1],xe=function(){return L?(0,t.jsx)(O.ko,{progress:ye}):(0,t.jsx)(t.Fragment,{})},Oe=(0,d.useCallback)(function(m,o){L&&e.changeProgress(o),ve&&e.tempSave(m)},[L]),Pe=function(){var o;return(0,t.jsxs)("div",{className:"password-confirm",children:[(0,t.jsx)("h3",{children:(o=e.project)===null||o===void 0?void 0:o.name}),(0,t.jsx)(A.Z,{visible:!0,footer:null,closable:!1,width:350,children:(0,t.jsxs)(Z.Z,{style:{margin:"10px 0"},children:[(0,t.jsx)("div",{style:{textAlign:"center",fontSize:20,marginBottom:10},children:"\u8BF7\u8F93\u5165\u5BC6\u7801\u586B\u5199\u95EE\u5377"}),(0,t.jsx)(Z.Z.Item,{rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801!"}],validateStatus:R.validateStatus,help:R.help,children:(0,t.jsx)(V.Z.Password,{size:"large",placeholder:"\u5BC6\u7801",prefix:(0,t.jsx)(G,{}),onChange:function(u){return Se(u.target.value)},iconRender:function(u){return u?(0,t.jsx)(W,{}):(0,t.jsx)(X.Z,{})}})}),(0,t.jsx)(w.Z,{type:"primary",size:"large",htmlType:"submit",block:!0,loading:e.verifying,onClick:function(){b&&e.verifyPassword(b).then(function(u){u||Ce({help:"\u5BC6\u7801\u9A8C\u8BC1\u5931\u8D25",validateStatus:"error"})})},children:"\u9A8C\u8BC1\u5E76\u586B\u5199\u95EE\u5377"})]})})]})},Le=function(){return(0,t.jsx)(z.Z,{visible:!0,width:"100%",closable:!1,bodyStyle:{padding:0},children:(0,t.jsx)(ae.default,{onOk:function(){e.loadProject()}})})},N=function(o){var f,u;return(0,t.jsxs)("div",{className:"render-failure ".concat(P?"mobile":"phone"),children:[((f=e.project)===null||f===void 0?void 0:f.name)&&(0,t.jsx)("div",{className:"title",children:(u=e.project)===null||u===void 0?void 0:u.name}),(0,t.jsxs)("div",{className:"content",children:[(0,t.jsx)("div",{children:(0,t.jsx)(O.AT,{})}),(0,t.jsx)("h2",{children:pe||o}),(0,t.jsx)("div",{children:"\u611F\u8C22\u5173\u6CE8\uFF01"})]})]})},Te=function(){if(console.log(e.survey),e.loading)return(0,t.jsx)(q.Z,{});if(e.errorCode!==200)return N();if(he&&!(0,x.CL)())return N("\u53EA\u80FD\u5728\u5FAE\u4FE1\u4E2D\u6253\u5F00");if(e.survey&&!i){var o;return(0,t.jsx)(_.O,{ref:oe,loading:le||ue,questionNumber:fe,theme:P?"antdmobile":"antd",schema:e.survey,onChange:Oe,initialValues:((o=e.savedAnswer)===null||o===void 0?void 0:o.answer)||ce,onUpload:e.upload,onSubmit:function(u){e.saveData(u).then(function(){return ie(!0)})}})}if(e.loginRequired)return(0,t.jsx)("div",{children:Le()});if(e.passwordRequired)return(0,t.jsx)("div",{children:Pe()})},Ze=function(){return i?E?(0,t.jsxs)("div",{className:"success-content",children:[(0,t.jsx)(O.hl,{html:E}),(0,t.jsx)("div",{style:{textAlign:"center"},children:(0,t.jsx)(w.Z,{type:"link",onClick:function(){return window.close()},children:"\u5173\u95ED"},"console")})]}):(0,t.jsx)($.ZP,{status:"success",title:"\u7B54\u6848\u5DF2\u4FDD\u5B58!",extra:[(0,t.jsx)(w.Z,{type:"link",onClick:function(){return window.close()},children:"\u5173\u95ED"},"console")]}):(0,t.jsx)(t.Fragment,{})},Ie=function(){var o,f,u=(o=e.survey)===null||o===void 0||(f=o.attribute)===null||f===void 0?void 0:f.backgroundImage;if(u)return{backgroundImage:"url(/api/public/preview/".concat(u,")")}};return(0,t.jsx)(x.ff.Provider,{value:e,children:(0,t.jsxs)("div",{className:"survey ".concat(P?"mobile":"pc"),style:Ie(),children:[xe(),Te(),Ze()]})})}),ne=B}}]);
