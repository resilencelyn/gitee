(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[1835],{36432:function(Te,P,a){"use strict";a.r(P),a.d(P,{MobileOrPC:function(){return D},default:function(){return ae}});var Ze=a(57106),k=a(99683),Ie=a(57338),N=a(25084),Me=a(71194),$=a(50146),De=a(57663),w=a(71577),Be=a(9715),L=a(93766),Ee=a(47673),z=a(4107),C=a(2824),A=a(51615),f=a(67294),p=a(28991),V={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM540 701v53c0 4.4-3.6 8-8 8h-40c-4.4 0-8-3.6-8-8v-53a48.01 48.01 0 1156 0zm152-237H332V240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224z"}}]},name:"lock",theme:"filled"},H=V,T=a(27029),Z=function(s,r){return f.createElement(T.Z,(0,p.Z)((0,p.Z)({},s),{},{ref:r,icon:H}))};Z.displayName="LockFilled";var J=f.forwardRef(Z),U={icon:function(s,r){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M81.8 537.8a60.3 60.3 0 010-51.5C176.6 286.5 319.8 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c-192.1 0-335.4-100.5-430.2-300.2z",fill:r}},{tag:"path",attrs:{d:"M512 258c-161.3 0-279.4 81.8-362.7 254C232.6 684.2 350.7 766 512 766c161.4 0 279.5-81.8 362.7-254C791.4 339.8 673.3 258 512 258zm-4 430c-97.2 0-176-78.8-176-176s78.8-176 176-176 176 78.8 176 176-78.8 176-176 176z",fill:r}},{tag:"path",attrs:{d:"M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258s279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766z",fill:s}},{tag:"path",attrs:{d:"M508 336c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z",fill:s}}]}},name:"eye",theme:"twotone"},G=U,I=function(s,r){return f.createElement(T.Z,(0,p.Z)((0,p.Z)({},s),{},{ref:r,icon:G}))};I.displayName="EyeTwoTone";var K=f.forwardRef(I),Q=a(88633),W=a(2299),M=a(87998),X=a(92725),x=a(14247),Y=a(7354),Fe=a(72487),y=a(3182),q=a(69610),_=a(54941),ee=a(94043),g=a.n(ee),j=a(68489),i=a(54531),re=function(){function h(s){(0,q.Z)(this,h),this.id=void 0,this.project=void 0,this.survey=void 0,this.loading=void 0,this.verifying=!1,this.saving=!1,this.isPC=void 0,this.startTime=void 0,this.errorCode=void 0,this.errorMessage=void 0,this.id=s,this.makeObservable(),this.loadProject(),this.startTime=new Date().getTime()}return(0,_.Z)(h,[{key:"makeObservable",value:function(){(0,i.Ou)(this,{id:i.LO.ref,survey:i.LO.ref,loading:i.LO.ref,saving:i.LO.ref,verifying:i.LO.ref,project:i.LO.ref,errorCode:i.LO.ref,errorMessage:i.LO.ref,passwordRequired:i.LO.computed,loginRequired:i.LO.computed,tempSaveId:i.LO.computed,savedAnswer:i.LO.computed,status:i.LO.computed,setting:i.LO.computed,tempSave:i.aD,saveData:i.aD,loadProject:i.aD,verifyPassword:i.aD})}},{key:"setting",get:function(){var r;return(r=this.project)===null||r===void 0?void 0:r.setting}},{key:"status",get:function(){var r;return(r=this.project)===null||r===void 0?void 0:r.status}},{key:"passwordRequired",get:function(){var r;return(r=this.project)===null||r===void 0?void 0:r.passwordRequired}},{key:"loginRequired",get:function(){var r;return(r=this.project)===null||r===void 0?void 0:r.loginRequired}},{key:"tempSaveId",get:function(){return"savedAnswer-"+this.id}},{key:"savedAnswer",get:function(){var r=localStorage.getItem(this.tempSaveId);return r&&JSON.parse(r)}},{key:"tempSave",value:function(r){var u=localStorage.getItem(this.tempSaveId),e;u?(e=JSON.parse(u),e.answer=r):e={answer:r,metaInfo:{answerInfo:{startTime:new Date().getTime()}}},localStorage.setItem(this.tempSaveId,JSON.stringify(e))}},{key:"saveData",value:function(){var s=(0,y.Z)(g().mark(function u(e){var v;return g().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return this.saving=!0,v={answer:e,projectId:this.id,metaInfo:{answerInfo:{startTime:this.startTime,endTime:new Date().getTime()}}},n.next=4,j.hi.post("/api/public/saveAnswer",v);case 4:localStorage.removeItem(this.tempSaveId),this.saving=!1;case 6:case"end":return n.stop()}},u,this)}));function r(u){return s.apply(this,arguments)}return r}()},{key:"loadProject",value:function(){var s=(0,y.Z)(g().mark(function u(){var e;return g().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.loading=!0,c.next=3,j.hi.post("/api/public/loadProject",{id:this.id});case 3:e=c.sent,e.success?(this.project=e.data,this.survey=e.data.survey):this.errorMessage=e.message,this.errorCode=e.code,this.loading=!1;case 7:case"end":return c.stop()}},u,this)}));function r(){return s.apply(this,arguments)}return r}()},{key:"verifyPassword",value:function(){var s=(0,y.Z)(g().mark(function u(e){var v;return g().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return this.verifying=!0,n.next=3,j.hi.post("/api/public/verifyPassword",{id:this.id,password:e});case 3:if(v=n.sent,this.verifying=!1,v.code!==200){n.next=8;break}return this.survey=v.data.survey,n.abrupt("return",!0);case 8:return n.abrupt("return",!1);case 9:case"end":return n.stop()}},u,this)}));function r(u){return s.apply(this,arguments)}return r}()},{key:"upload",value:function(){var s=(0,y.Z)(g().mark(function u(e,v){return g().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",j.hi.upload("/api/public/upload",{file:e},v));case 1:case"end":return n.stop()}},u)}));function r(u,e){return s.apply(this,arguments)}return r}()}]),h}(),te=a(19319),t=a(85893),D=(0,W.Pi)(function(){var h,s,r=(0,A.UO)(),u=r.id,e=(0,f.useMemo)(function(){return new re(u)},[u]),v=(0,f.useState)(!1),c=(0,C.Z)(v,2),n=c[0],se=c[1],O=(0,f.useMemo)(function(){return(0,M.SB)()},[]),ne=(0,f.useRef)(null),ie=e.saving,oe=e.loading,ue=(h=e.setting)===null||h===void 0?void 0:h.answerSetting,S=ue||{},le=S.autoSave,de=S.progressBar,ve=S.initialValues,ce=S.questionNumber,fe=(s=e.setting)===null||s===void 0?void 0:s.submittedSetting,he=fe||{},B=he.contentHtml,be=e.errorCode,ge=e.errorMessage,me=(0,f.useState)(),E=(0,C.Z)(me,2),F=E[0],pe=E[1],ye=(0,f.useState)({}),b=(0,C.Z)(ye,2),R=b[0],je=b[1],Se=function(){return de?(0,t.jsx)(x.ko,{}):(0,t.jsx)(t.Fragment,{})},we=function(){var o;return(0,t.jsxs)("div",{className:"password-confirm",children:[(0,t.jsx)("h3",{children:(o=e.project)===null||o===void 0?void 0:o.name}),(0,t.jsx)($.Z,{visible:!0,footer:null,closable:!1,width:350,children:(0,t.jsxs)(L.Z,{style:{margin:"10px 0"},children:[(0,t.jsx)("div",{style:{textAlign:"center",fontSize:20,marginBottom:10},children:"\u8BF7\u8F93\u5165\u5BC6\u7801\u586B\u5199\u95EE\u5377"}),(0,t.jsx)(L.Z.Item,{rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801!"}],validateStatus:R.validateStatus,help:R.help,children:(0,t.jsx)(z.Z.Password,{size:"large",placeholder:"\u5BC6\u7801",prefix:(0,t.jsx)(J,{}),onChange:function(d){return pe(d.target.value)},iconRender:function(d){return d?(0,t.jsx)(K,{}):(0,t.jsx)(Q.Z,{})}})}),(0,t.jsx)(w.Z,{type:"primary",size:"large",htmlType:"submit",block:!0,loading:e.verifying,onClick:function(){F&&e.verifyPassword(F).then(function(d){d||je({help:"\u5BC6\u7801\u9A8C\u8BC1\u5931\u8D25",validateStatus:"error"})})},children:"\u9A8C\u8BC1\u5E76\u586B\u5199\u95EE\u5377"})]})})]})},Ce=function(){return(0,t.jsx)(N.Z,{visible:!0,width:"100%",closable:!1,bodyStyle:{padding:0},children:(0,t.jsx)(te.default,{onOk:function(){e.loadProject()}})})},xe=function(){var o,l;return(0,t.jsxs)("div",{className:"render-failure ".concat(O?"mobile":"phone"),children:[((o=e.project)===null||o===void 0?void 0:o.name)&&(0,t.jsx)("div",{className:"title",children:(l=e.project)===null||l===void 0?void 0:l.name}),(0,t.jsxs)("div",{className:"content",children:[(0,t.jsx)("div",{children:(0,t.jsx)(x.AT,{})}),(0,t.jsx)("h2",{children:ge}),(0,t.jsx)("div",{children:"\u611F\u8C22\u5173\u6CE8\uFF01"})]})]})},Oe=function(){if(e.loading)return(0,t.jsx)(X.Z,{});if(e.errorCode!==200)return xe();if(e.survey&&!n){var o;return(0,t.jsx)(Y.O,{ref:ne,loading:ie||oe,questionNumber:ce,theme:O?"antdmobile":"antd",schema:e.survey,onChange:function(d){le&&e.tempSave(d)},initialValues:((o=e.savedAnswer)===null||o===void 0?void 0:o.answer)||ve,onUpload:e.upload,onSubmit:function(d){e.saveData(d).then(function(){return se(!0)})}})}if(e.loginRequired)return(0,t.jsx)("div",{children:Ce()});if(e.passwordRequired)return(0,t.jsx)("div",{children:we()})},Pe=function(){return n?B?(0,t.jsxs)("div",{className:"success-content",children:[(0,t.jsx)(x.hl,{html:B}),(0,t.jsx)("div",{style:{textAlign:"center"},children:(0,t.jsx)(w.Z,{type:"link",onClick:function(){return window.close()},children:"\u5173\u95ED"},"console")})]}):(0,t.jsx)(k.ZP,{status:"success",title:"\u7B54\u6848\u5DF2\u4FDD\u5B58!",extra:[(0,t.jsx)(w.Z,{type:"link",onClick:function(){return window.close()},children:"\u5173\u95ED"},"console")]}):(0,t.jsx)(t.Fragment,{})},Re=function(){},Le=function(){var o,l,d=(o=e.survey)===null||o===void 0||(l=o.attribute)===null||l===void 0?void 0:l.backgroundImage;if(d)return{backgroundImage:"url(/api/public/preview/".concat(d,")")}};return(0,t.jsx)(M.ff.Provider,{value:e,children:(0,t.jsxs)("div",{className:"survey ".concat(O?"mobile":"pc"),style:Le(),children:[Se(),Oe(),Pe()]})})}),ae=D}}]);
