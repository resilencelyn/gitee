(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[1835],{34687:function(D){D.exports={container:"container___1sYa-",lang:"lang___l6cji",content:"content___2zk1-",top:"top___1C1Zi",header:"header___5xZ3f",logo:"logo___2hXsy",title:"title___1-xuF",desc:"desc___-njyT",main:"main___x4OjT",icon:"icon___rzGKO",other:"other___lLyaU",register:"register___11Twg",prefixIcon:"prefixIcon___23Xrx"}},29791:function(D,y,e){"use strict";var z=e(24557),x=e(78874),C=e(11013),S=e(97544),B=e(85893);y.Z=function(){return(0,B.jsx)(S.Z,{copyright:!1,links:[{key:"Survey King",title:(0,B.jsx)(z.Z,{}),href:"https://surveyking.cn",blankTarget:!0},{key:"github",title:(0,B.jsx)(x.Z,{}),href:"https://github.com/javahuang/SurveyKing",blankTarget:!0},{key:"gitee",title:(0,B.jsx)(C.Z,{}),href:"https://gitee.com/surveyking/surveyking",blankTarget:!0}]})}},30950:function(D,y,e){"use strict";e.r(y),e.d(y,{MobileOrPC:function(){return K},default:function(){return W}});var z=e(57106),x=e(99683),C=e(57338),S=e(25084),B=e(71194),k=e(50146),ee=e(57663),_=e(71577),re=e(9715),U=e(93766),V=e(47673),H=e(4107),L=e(2824),j=e(51615),P=e(67294),G=e(21652),J=e(47219),m=e(88633),X=e(2299),F=e(87998),Y=e(92725),I=e(14247),i=e(7354),se=e(72487),T=e(3182),Q=e(69610),A=e(54941),Z=e(94043),p=e.n(Z),R=e(68489),l=e(54531),q=function(){function v(n){(0,Q.Z)(this,v),this.id=void 0,this.project=void 0,this.survey=void 0,this.loading=void 0,this.verifying=!1,this.saving=!1,this.isPC=void 0,this.startTime=void 0,this.id=n,this.makeObservable(),this.loadProject(),this.startTime=new Date().getTime()}return(0,A.Z)(v,[{key:"makeObservable",value:function(){(0,l.Ou)(this,{id:l.LO.ref,survey:l.LO.ref,loading:l.LO.ref,saving:l.LO.ref,verifying:l.LO.ref,project:l.LO.ref,passwordRequired:l.LO.computed,loginRequired:l.LO.computed,tempSaveId:l.LO.computed,savedAnswer:l.LO.computed,status:l.LO.computed,setting:l.LO.computed,tempSave:l.aD,saveData:l.aD,loadProject:l.aD,verifyPassword:l.aD})}},{key:"setting",get:function(){var t;return(t=this.project)===null||t===void 0?void 0:t.setting}},{key:"status",get:function(){var t;return(t=this.project)===null||t===void 0?void 0:t.status}},{key:"passwordRequired",get:function(){var t;return(t=this.project)===null||t===void 0?void 0:t.passwordRequired}},{key:"loginRequired",get:function(){var t;return(t=this.project)===null||t===void 0?void 0:t.loginRequired}},{key:"tempSaveId",get:function(){return"savedAnswer-"+this.id}},{key:"savedAnswer",get:function(){var t=localStorage.getItem(this.tempSaveId);return t&&JSON.parse(t)}},{key:"tempSave",value:function(t){var c=localStorage.getItem(this.tempSaveId),r;c?(r=JSON.parse(c),r.answer=t):r={answer:t,metaInfo:{answerInfo:{startTime:new Date().getTime()}}},localStorage.setItem(this.tempSaveId,JSON.stringify(r))}},{key:"saveData",value:function(){var n=(0,T.Z)(p().mark(function c(r){var o;return p().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return this.saving=!0,o={answer:r,projectId:this.id,metaInfo:{answerInfo:{startTime:this.startTime,endTime:new Date().getTime()}}},a.next=4,R.hi.post("/api/public/saveAnswer",o);case 4:localStorage.removeItem(this.tempSaveId),this.saving=!1;case 6:case"end":return a.stop()}},c,this)}));function t(c){return n.apply(this,arguments)}return t}()},{key:"loadProject",value:function(){var n=(0,T.Z)(p().mark(function c(){var r;return p().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return this.loading=!0,d.next=3,R.hi.get("/api/public/loadProject?id=".concat(this.id));case 3:r=d.sent,this.project=r,this.survey=r==null?void 0:r.survey,this.loading=!1;case 7:case"end":return d.stop()}},c,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"verifyPassword",value:function(){var n=(0,T.Z)(p().mark(function c(r){var o;return p().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return this.verifying=!0,a.next=3,R.hi.post("/api/public/verifyPassword",{id:this.id,password:r});case 3:if(o=a.sent,this.verifying=!1,o.code!==200){a.next=8;break}return this.survey=o.data.survey,a.abrupt("return",!0);case 8:return a.abrupt("return",!1);case 9:case"end":return a.stop()}},c,this)}));function t(c){return n.apply(this,arguments)}return t}()},{key:"upload",value:function(){var n=(0,T.Z)(p().mark(function c(r,o){return p().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",R.hi.upload("/api/public/upload",{file:r},o));case 1:case"end":return a.stop()}},c)}));function t(c,r){return n.apply(this,arguments)}return t}()}]),v}(),b=e(19319),s=e(85893),K=(0,X.Pi)(function(){var v,n,t=(0,j.UO)(),c=t.id,r=(0,P.useMemo)(function(){return new q(c)},[c]),o=(0,P.useState)(!1),d=(0,L.Z)(o,2),a=d[0],E=d[1],O=(0,P.useMemo)(function(){return(0,F.SB)()},[]),N=(0,P.useRef)(null),w=r.saving,$=r.loading,te=(v=r.setting)===null||v===void 0?void 0:v.answerSetting,u=te||{},le=u.autoSave,de=u.progressBar,ve=u.initialValues,ce=u.questionNumber,ge=(n=r.setting)===null||n===void 0?void 0:n.submittedSetting,me=ge||{},ae=me.contentHtml,fe=(0,P.useState)(),ne=(0,L.Z)(fe,2),ie=ne[0],he=ne[1],pe=(0,P.useState)({}),ue=(0,L.Z)(pe,2),oe=ue[0],_e=ue[1],je=function(){return de?(0,s.jsx)(I.ko,{}):(0,s.jsx)(s.Fragment,{})},Ee=function(){var g;return(0,s.jsxs)("div",{className:"password-confirm",children:[(0,s.jsx)("h3",{children:(g=r.project)===null||g===void 0?void 0:g.name}),(0,s.jsx)(k.Z,{visible:!0,footer:null,closable:!1,width:350,children:(0,s.jsxs)(U.Z,{style:{margin:"10px 0"},children:[(0,s.jsx)("div",{style:{textAlign:"center",fontSize:20,marginBottom:10},children:"\u8BF7\u8F93\u5165\u5BC6\u7801\u586B\u5199\u95EE\u5377"}),(0,s.jsx)(U.Z.Item,{rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801!"}],validateStatus:oe.validateStatus,help:oe.help,children:(0,s.jsx)(H.Z.Password,{size:"large",placeholder:"\u5BC6\u7801",prefix:(0,s.jsx)(G.Z,{}),onChange:function(h){return he(h.target.value)},iconRender:function(h){return h?(0,s.jsx)(J.Z,{}):(0,s.jsx)(m.Z,{})}})}),(0,s.jsx)(_.Z,{type:"primary",size:"large",htmlType:"submit",block:!0,loading:r.verifying,onClick:function(){ie&&r.verifyPassword(ie).then(function(h){h||_e({help:"\u5BC6\u7801\u9A8C\u8BC1\u5931\u8D25",validateStatus:"error"})})},children:"\u9A8C\u8BC1\u5E76\u586B\u5199\u95EE\u5377"})]})})]})},ye=function(){return(0,s.jsx)(S.Z,{visible:!0,width:"100%",closable:!1,bodyStyle:{padding:0},children:(0,s.jsx)(b.default,{onOk:function(){r.loadProject()}})})},Pe=function(){var g;if((g=r.project)!==null&&g!==void 0&&g.name){var f;return(0,s.jsxs)("div",{className:"render-failure ".concat(O?"mobile":"phone"),children:[(0,s.jsx)("div",{className:"title",children:(f=r.project)===null||f===void 0?void 0:f.name}),(0,s.jsxs)("div",{className:"content",children:[(0,s.jsx)("div",{children:(0,s.jsx)(I.AT,{})}),(0,s.jsx)("h2",{children:"\u62B1\u6B49\uFF01\u4F60\u8BBF\u95EE\u7684\u95EE\u5377\u5DF2\u505C\u6B62\u6536\u96C6\u6570\u636E"}),(0,s.jsx)("div",{children:"\u611F\u8C22\u5173\u6CE8\uFF01"})]})]})}return(0,s.jsx)("div",{className:"render-failure ".concat(O?"mobile":"phone"),children:(0,s.jsxs)("div",{className:"content",children:[(0,s.jsx)("div",{children:(0,s.jsx)(I.AT,{})}),(0,s.jsx)("h2",{children:"\u5BF9\u4E0D\u8D77, \u4F60\u8BBF\u95EE\u7684\u9875\u9762\u4E0D\u5B58\u5728"}),(0,s.jsx)("div",{children:"\u611F\u8C22\u5173\u6CE8\uFF01"})]})})},Oe=function(){if(r.loading)return(0,s.jsx)(Y.Z,{});if(r.status!==1)return Pe();if(r.survey&&!a){var g;return(0,s.jsx)(i.O,{ref:N,loading:w||$,questionNumber:ce,theme:O?"antdmobile":"antd",schema:r.survey,onChange:function(h){le&&r.tempSave(h)},initialValues:((g=r.savedAnswer)===null||g===void 0?void 0:g.answer)||ve,onUpload:r.upload,onSubmit:function(h){r.saveData(h).then(function(){return E(!0)})}})}if(r.loginRequired)return(0,s.jsx)("div",{children:ye()});if(r.passwordRequired)return(0,s.jsx)("div",{children:Ee()})},Me=function(){return a?ae?(0,s.jsxs)("div",{className:"success-content",children:[(0,s.jsx)(I.hl,{html:ae}),(0,s.jsx)("div",{style:{textAlign:"center"},children:(0,s.jsx)(_.Z,{type:"link",onClick:function(){return window.close()},children:"\u5173\u95ED"},"console")})]}):(0,s.jsx)(x.ZP,{status:"success",title:"\u7B54\u6848\u5DF2\u4FDD\u5B58!",extra:[(0,s.jsx)(_.Z,{type:"link",onClick:function(){return window.close()},children:"\u5173\u95ED"},"console")]}):(0,s.jsx)(s.Fragment,{})},xe=function(){},De=function(){var g,f,h=(g=r.survey)===null||g===void 0||(f=g.attribute)===null||f===void 0?void 0:f.backgroundImage;if(h)return{backgroundImage:"url(/api/public/preview/".concat(h,")")}};return(0,s.jsx)(F.ff.Provider,{value:r,children:(0,s.jsxs)("div",{className:"survey ".concat(O?"mobile":"pc"),style:De(),children:[je(),Oe(),Me()]})})}),W=K},19319:function(D,y,e){"use strict";e.r(y);var z=e(34792),x=e(48086),C=e(3182),S=e(2824),B=e(17462),k=e(76772),ee=e(94043),_=e.n(ee),re=e(89366),U=e(2603),V=e(67294),H=e(15196),L=e(5966),j=e(42285),P=e(73727),G=e(29791),J=e(34687),m=e.n(J),X=e(27400),F=e(77613),Y=e(5481),I=e.n(Y),i=e(85893),se=function(A){var Z=A.content;return(0,i.jsx)(k.Z,{style:{marginBottom:24},message:Z,type:"error",showIcon:!0})},T=function(A){var Z=(0,V.useState)(!1),p=(0,S.Z)(Z,2),R=p[0],l=p[1],q=(0,V.useState)(),b=(0,S.Z)(q,2),s=b[0],K=b[1],W=(0,X.a)(),v=W.system,n=(0,j.YB)(),t=function(){var r=(0,C.Z)(_().mark(function o(){return _().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:case"end":return a.stop()}},o)}));return function(){return r.apply(this,arguments)}}(),c=function(){var r=(0,C.Z)(_().mark(function o(d){var a,E,O,N,w,$;return _().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return l(!0),u.prev=1,u.next=4,W.login(d);case 4:if(a=u.sent,!a.success){u.next=19;break}if(E=n.formatMessage({id:"pages.login.success",defaultMessage:"\u767B\u5F55\u6210\u529F\uFF01"}),x.default.success(E),!A.onOk){u.next=11;break}return A.onOk(),u.abrupt("return");case 11:return u.next=13,t();case 13:if(j.m8){u.next=15;break}return u.abrupt("return");case 15:return O=j.m8.location.query,N=O,w=N.redirect,j.m8.push(w||"/"),u.abrupt("return");case 19:K(a.message&&"error"),u.next=26;break;case 22:u.prev=22,u.t0=u.catch(1),$=n.formatMessage({id:"pages.login.failure",defaultMessage:"\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5\uFF01"}),x.default.error($);case 26:l(!1);case 27:case"end":return u.stop()}},o,null,[[1,22]])}));return function(d){return r.apply(this,arguments)}}();return(0,i.jsxs)("div",{className:m().container,children:[(0,i.jsx)("div",{className:m().lang,"data-lang":!0,children:j.pD&&(0,i.jsx)(j.pD,{})}),(0,i.jsxs)("div",{className:m().content,children:[(0,i.jsxs)("div",{className:m().top,children:[(0,i.jsx)("div",{className:m().header,children:(0,i.jsxs)(P.rU,{to:"/",children:[(0,i.jsx)("img",{alt:"logo",className:m().logo,src:v.avatar?"/api/public/preview/".concat(v==null?void 0:v.avatar):I()}),(0,i.jsx)("span",{className:m().title,children:v==null?void 0:v.name})]})}),(0,i.jsx)("div",{className:m().desc,children:v==null?void 0:v.description})]}),(0,i.jsx)("div",{className:m().main,children:(0,i.jsxs)(H.ZP,{initialValues:{autoLogin:!0},submitter:{searchConfig:{submitText:n.formatMessage({id:"pages.login.submit",defaultMessage:"\u767B\u5F55"})},render:function(o,d){return d.pop()},submitButtonProps:{loading:R,size:"large",style:{width:"100%"}}},onFinish:function(){var r=(0,C.Z)(_().mark(function o(d){return _().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,c(d);case 2:case"end":return E.stop()}},o)}));return function(o){return r.apply(this,arguments)}}(),children:[s==="error"&&(0,i.jsx)(se,{content:n.formatMessage({id:"pages.login.accountLogin.errorMessage",defaultMessage:"\u8D26\u6237\u6216\u5BC6\u7801\u9519\u8BEF"})}),(0,i.jsx)(L.Z,{name:"username",fieldProps:{size:"large",prefix:(0,i.jsx)(re.Z,{className:m().prefixIcon})},placeholder:n.formatMessage({id:"pages.login.username.placeholder",defaultMessage:"\u7528\u6237\u540D"}),rules:[{required:!0,message:(0,i.jsx)(j._H,{id:"pages.login.username.required",defaultMessage:"\u8BF7\u8F93\u5165\u7528\u6237\u540D!"})}]}),(0,i.jsx)(L.Z.Password,{name:"password",fieldProps:{size:"large",prefix:(0,i.jsx)(U.Z,{className:m().prefixIcon})},placeholder:n.formatMessage({id:"pages.login.password.placeholder",defaultMessage:"\u5BC6\u7801"}),rules:[{required:!0,message:(0,i.jsx)(j._H,{id:"pages.login.password.required",defaultMessage:"\u8BF7\u8F93\u5165\u5BC6\u7801\uFF01"})}]})]})})]}),(0,i.jsx)(G.Z,{})]})};y.default=(0,F.P)(T)},5481:function(D,y,e){D.exports=e.p+"static/logo.de1a765f.svg"}}]);
