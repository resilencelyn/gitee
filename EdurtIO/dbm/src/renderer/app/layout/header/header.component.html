<nz-header nzTheme="light" class="layout">
  <div class="logo">
    <a [routerLink]="['/']">
      <nz-avatar [nzSize]="32" nzSrc="shared/assets/icons/favicon.png"></nz-avatar>
    </a>
  </div>
  <ul nz-menu nzMode="horizontal">
    <li nz-submenu [nzTitle]="queryMenuItemTitle">
      <ul>
        <li nz-menu-item>
          <a [routerLink]="['/query/query']" class="dropdown-item">
            <i class="fa fa-search"> {{ 'common.query' | translate }}</i>
          </a>
        </li>
        <li nz-menu-item>
          <a [routerLink]="['/query/history']">
            <i class="fa fa-history"> {{ 'common.history' | translate }}</i>
          </a>
        </li>
        <li nz-menu-item>
          <a [routerLink]="['/query/snippet']">
            <i class="fa fa-code"> {{ 'common.snippet' | translate }}</i>
          </a>
        </li>
      </ul>
    </li>
    <li nz-submenu [nzTitle]="managementMenuItemTitle">
      <ul>
        <li nz-menu-item>
          <a [routerLink]="['/management/datasource']" class="dropdown-item">
            <i class="fa fa-dashcube"> {{ 'common.datasource' | translate }}</i>
          </a>
        </li>
        <li nz-menu-item>
          <a [routerLink]="['/management/metadata']" class="dropdown-item">
            <i class="fa fa-archive"> {{ 'common.metadata' | translate }}</i>
          </a>
        </li>
      </ul>
    </li>
    <li nz-submenu [nzTitle]="monitorMenuItemTitle">
      <ul>
        <li nz-menu-item>
          <a [routerLink]="['/monitor/processor']" class="dropdown-item">
            <i class="fa fa-bullseye"> {{'common.processor'|translate}}</i>
          </a>
        </li>
        <li nz-menu-item>
          <a [routerLink]="['/monitor/connection']" class="dropdown-item">
            <i class="fa fa-connectdevelop"> {{'common.connection'|translate}}</i>
          </a>
        </li>
        <li nz-menu-item>
          <a [routerLink]="['/monitor/mutations']" class="dropdown-item">
            <i class="fa fa-anchor"> {{'common.mutations'|translate}}</i>
          </a>
        </li>
        <li nz-menu-item>
          <a [routerLink]="['/monitor/query']" class="dropdown-item">
            <i class="fa fa-search"> {{'common.query'|translate}}</i>
          </a>
        </li>
      </ul>
    </li>
    <li nz-submenu [nzTitle]="toolMenuItemTitle">
      <ul>
        <li nz-menu-item>
          <a [routerLink]="['/tools/track']" class="dropdown-item">
            <i class="fa fa-wrench"> {{'common.track'|translate}}</i>
          </a>
        </li>
        <li nz-menu-item>
          <a [routerLink]="['/tools/migrte']" class="dropdown-item">
            <i class="fa fa-exchange"> {{'common.migrte'|translate}}</i>
          </a>
        </li>
      </ul>
    </li>
    <li nz-submenu [nzTitle]="githubItemTitle" (click)="handlerDirectGitHub()" style="float: right;"></li>
    <li nz-submenu [nzTitle]="systemMenuItemTitle" style="float: right;">
      <ul>
        <li nz-menu-item>
          <a nzSize="mini" (click)="handlerUpdate(true)">
            <i class="fa fa-refresh"> {{'common.update'|translate}}</i>
          </a>
        </li>
        <li nz-menu-item>
          <a [routerLink]="['/system/basic']" class="dropdown-item">
            <i class="fa fa-bandcamp"> {{'common.basic'|translate}}</i>
          </a>
        </li>
        <li nz-menu-item>
          <a [routerLink]="['/system/editor']" class="dropdown-item">
            <i class="fa fa-edit"> {{'common.editor'|translate}}</i>
          </a>
        </li>
      </ul>
    </li>
  </ul>
  <ng-template #queryMenuItemTitle>
    <i class="fa fa-search"></i>&nbsp;{{'common.query'|translate}}
  </ng-template>
  <ng-template #managementMenuItemTitle>
    <i class="fa fa-magnet"></i>&nbsp;{{'common.management'|translate}}
  </ng-template>
  <ng-template #monitorMenuItemTitle>
    <i class="fa fa-desktop"></i>&nbsp;{{'common.monitor'|translate}}
  </ng-template>
  <ng-template #toolMenuItemTitle>
    <i class="fa fa-gavel"></i>&nbsp;{{'common.tools'|translate}}
  </ng-template>
  <ng-template #systemMenuItemTitle>
    <i class="fa fa-gear"></i>&nbsp;{{'common.system'|translate}}
  </ng-template>
  <ng-template #githubItemTitle>
    <i class="fa fa-github"></i>&nbsp;{{'common.github'|translate}}
  </ng-template>
</nz-header>
<nz-modal [(nzVisible)]="dialog.update" [nzTitle]="modalTitle" [nzContent]="modalContent" [nzFooter]="modalFooter"
          (nzOnCancel)="handlerUpdate(false)" [nzMaskClosable]="false" [nzClosable]="false" nzWidth="80%">
  <ng-template #modalTitle>{{'common.update'|translate}}</ng-template>
  <ng-template #modalContent>
    <form nz-form nzSize="mini">
      <nz-form-item *ngIf="updateResponse?.state === update.failed">
        <nz-form-control [nzSm]="24" [nzXs]="24">
          <nz-alert nzType="error" nzMessage="{{updateResponse.message}}"></nz-alert>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSm]="8" [nzXs]="24">{{'common.current'|translate}}{{'common.version'|translate}}
        </nz-form-label>
        <nz-form-control [nzSm]="14" [nzXs]="24">
          <nz-tag [nzColor]="'#2db7f5'" nzSize="mini">{{version}}</nz-tag>
        </nz-form-control>
      </nz-form-item>
      <nz-spin [nzSpinning]="loading.button">
        <div *ngIf="latestVersionInfo; else noNowVersion">
          <nz-divider nzText="{{'common.new'|translate}}{{'common.version'|translate}}" nzOrientation="left">
          </nz-divider>
          <nz-form-item>
            <nz-form-control [nzSm]="24" [nzXs]="24">
              <nz-alert nzType="warning" nzMessage="{{'alert.not_support_online'|translate}}"></nz-alert>
            </nz-form-control>
          </nz-form-item>
          <nz-form-item>
            <nz-form-label [nzSm]="8" [nzXs]="24">{{'common.latest'|translate}}{{'common.version'|translate}}
            </nz-form-label>
            <nz-form-control [nzSm]="14" [nzXs]="24">
              <nz-tag [nzColor]="'#f50'" nzSize="mini">{{latestVersionInfo?.version}}</nz-tag>
              <!-- <button nz-button nzType="primary" (click)="handlerDownload()" [disabled]="!disabled.button">
                <i class="fa fa-download"></i>
              </button> -->
              <!-- <button nz-button nzType="default" nzDanger nz-popover nzPopoverContent="{{updateResponse?.message}}"
                *ngIf="updateResponse?.state === update.failed">
                <i class="fa fa-exclamation-triangle"></i>
              </button> -->
            </nz-form-control>
          </nz-form-item>
          <nz-divider nzText="{{'common.release'|translate}}{{'common.note'|translate}}" nzOrientation="left">
          </nz-divider>
          <nz-form-item>
            <nz-form-control [nzSm]="24" [nzXs]="24">
              <markdown ngPreserveWhitespaces>
                {{releaseNotes}}
              </markdown>
            </nz-form-control>
          </nz-form-item>
          <!-- <nz-form-item *ngIf="!disabled.button">
            <nz-form-label [nzSm]="8" [nzXs]="24">{{'common.download'|translate}}{{'common.percentage'|translate}}
            </nz-form-label>
            <nz-form-control [nzSm]="14" [nzXs]="24">
              <nz-progress [nzPercent]="percentage"></nz-progress>
              <button nz-button nzType="primary" nzDanger (click)="handlerCancel()">
                <i class="fa fa-stop-circle"></i>
              </button>
            </nz-form-control>
          </nz-form-item> -->
        </div>
        <ng-template #noNowVersion>
          <nz-form-item>
            <nz-form-control [nzSm]="24" [nzXs]="24">
              <nz-alert nzType="success" nzMessage="{{'alert.noversion'|translate}}"></nz-alert>
            </nz-form-control>
          </nz-form-item>
        </ng-template>
      </nz-spin>
    </form>
  </ng-template>
  <ng-template #modalFooter>
    <button nz-button nzType="default" (click)="handlerUpdate(false)"
            [disabled]="!disabled.button">{{'common.cancel'|translate}}</button>
  </ng-template>
</nz-modal>
