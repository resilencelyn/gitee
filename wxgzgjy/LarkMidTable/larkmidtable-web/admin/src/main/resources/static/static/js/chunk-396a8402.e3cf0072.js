(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-396a8402"],{1859:function(t,e,l){},6819:function(t,e,l){"use strict";l("69cc")},"69cc":function(t,e,l){},"77db":function(t,e,l){"use strict";l("bfee")},"92ac":function(t,e,l){"use strict";l("1859")},bfee:function(t,e,l){},eb18:function(t,e,l){"use strict";var s=function(){var t=this,e=t.$createElement,l=t._self._c||e;return l("div",[l("el-tabs",{attrs:{"tab-position":"top",type:"border-card"}},[l("el-tab-pane",{attrs:{label:"基础配置"}},[l("el-form",{attrs:{"label-width":"100px"}},[l("el-form-item",{attrs:{label:"基本信息"}},[l("my-input",{attrs:{label:"名称",nullable:!1},model:{value:t.detail.name,callback:function(e){t.$set(t.detail,"name",e)},expression:"detail.name"}}),l("my-input",{attrs:{label:"路径",preffix:"http://"+t.address+"/",nullable:!1,width:"400px"},model:{value:t.detail.path,callback:function(e){t.$set(t.detail,"path",e)},expression:"detail.path"}}),l("my-select",{attrs:{options:t.groups,label:"API分组",option_label:"name",option_value:"id",nullable:!1},model:{value:t.detail.groupId,callback:function(e){t.$set(t.detail,"groupId",e)},expression:"detail.groupId"}}),l("my-input",{attrs:{label:"描述",width:"500px"},model:{value:t.detail.note,callback:function(e){t.$set(t.detail,"note",e)},expression:"detail.note"}})],1),l("el-form-item",{attrs:{label:"sql"}},[l("div",[l("sql-code",{ref:"sqlCode",attrs:{apiSql:t.detail.sqlList}})],1)]),l("el-form-item",{attrs:{label:"参数"}},[t._l(t.detail.params,(function(e,s){return l("div",{staticStyle:{"margin-bottom":"5px",display:"flex","align-items":"center"}},[l("el-autocomplete",{staticStyle:{width:"200px","margin-right":"5px"},attrs:{"fetch-suggestions":t.parseParams,placeholder:"*参数名称"},model:{value:e.name,callback:function(l){t.$set(e,"name",l)},expression:"item.name"}}),l("el-select",{staticStyle:{"margin-right":"5px"},attrs:{options:t.options,placeholder:"*数据类型"},model:{value:e.type,callback:function(l){t.$set(e,"type",l)},expression:"item.type"}},t._l(t.options,(function(t){return l("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),l("el-input",{staticStyle:{width:"400px","margin-right":"5px"},attrs:{placeholder:"参数说明"},model:{value:e.note,callback:function(l){t.$set(e,"note",l)},expression:"item.note"}}),"/api/detail"!=t.$route.path?l("el-button",{attrs:{circle:"",type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(e){return t.deleteRow(s)}}}):t._e()],1)})),"/api/detail"!=t.$route.path?l("el-button",{attrs:{icon:"el-icon-plus",type:"primary",circle:"",size:"mini"},on:{click:t.addRow}}):t._e()],2),l("el-form-item",{attrs:{label:"Access"}},[l("el-radio-group",{model:{value:t.detail.previlege,callback:function(e){t.$set(t.detail,"previlege",e)},expression:"detail.previlege"}},[l("el-radio",{attrs:{label:0}},[t._v("私有API")]),l("el-radio",{attrs:{label:1}},[t._v("开放API")])],1),l("el-tooltip",{attrs:{placement:"top-start",effect:"dark"}},[l("div",{attrs:{slot:"content"},slot:"content"},[t._v("开放接口可以直接访问。私有接口在访问时必须在请求头中携带token，且该token值对此接口有访问权限，具体请到权限菜单查看")]),l("i",{staticClass:"el-icon-info tip"})])],1)],1)],1),l("el-tab-pane",{attrs:{label:"高级配置"}},[l("el-form",{attrs:{"label-width":"100px"}},[l("el-form-item",{attrs:{label:"数据转换"}},[t._l(this.$store.state.sqls,(function(e,s){return l("div",[l("span",[t._v("sql-"+t._s(e.id)+" :")]),l("my-input",{attrs:{label:"插件类名",placeholder:"填写数据转换插件java类名",width:"400px"},model:{value:e.transformPlugin,callback:function(l){t.$set(e,"transformPlugin",l)},expression:"item.transformPlugin"}}),l("my-input",{attrs:{label:"插件参数",width:"300px"},model:{value:e.transformPluginParams,callback:function(l){t.$set(e,"transformPluginParams",l)},expression:"item.transformPluginParams"}})],1)})),l("el-alert",{attrs:{type:"warning","show-icon":""}},[t._v(" 填写“插件类名”表示对sql执行结果开启数据转换功能，不填写表示不转换。 如果有多条sql，每个sql对应一个数据转换插件 ")])],2),l("el-form-item",{attrs:{label:"缓存"}},[l("el-tooltip",{attrs:{placement:"top-start",effect:"dark"}}),l("my-input",{attrs:{label:"插件类名",placeholder:"填写缓存插件java类名",width:"400px"},model:{value:t.detail.cachePlugin,callback:function(e){t.$set(t.detail,"cachePlugin",e)},expression:"detail.cachePlugin"}}),l("my-input",{attrs:{label:"插件参数",width:"300px"},model:{value:t.detail.cachePluginParams,callback:function(e){t.$set(t.detail,"cachePluginParams",e)},expression:"detail.cachePluginParams"}}),l("el-alert",{attrs:{type:"warning","show-icon":""}},[t._v("填写“插件类名”表示对结果数据开启缓存，不填写表示不开启缓存")]),l("div",[l("a",{staticClass:"el-icon-question",attrs:{target:"_blank",href:"https://gitee.com/freakchicken/db-api/blob/master/dbapi-assembly/docs/instruction.md#%E6%8F%92%E4%BB%B6"}},[t._v("什么是插件")]),l("a",{staticClass:"el-icon-question",attrs:{target:"_blank",href:"https://gitee.com/freakchicken/db-api/blob/master/dbapi-assembly/docs/plugin%20development.md#252-%E5%B1%80%E9%83%A8%E5%8F%82%E6%95%B0"}},[t._v("什么是插件参数")])])],1)],1)],1)],1)],1)},a=[],i=(l("a434"),function(){var t=this,e=t.$createElement,l=t._self._c||e;return l("div",{class:["root",t.isFullScreen?"full":""]},[l("div",{staticClass:"left"},[l("div",[l("my-select",{attrs:{options:t.datasources,nullable:!1,label:"数据源",size:"mini",width:"176px",option_label:"name",option_value:"id"},on:{onchange:t.getTables},model:{value:t.datasourceId,callback:function(e){t.datasourceId=e},expression:"datasourceId"}})],1),l("div",{staticClass:"bottom"},t._l(t.tables,(function(e,s){return l("div",[l("div",[l("div",{staticClass:"table",on:{click:function(l){return l.preventDefault(),t.getColumns(e.label,s)},contextmenu:function(e){return e.preventDefault(),t.showMenu()}}},[l("i",{staticClass:"iconfont icon-table"}),t._v(" "+t._s(e.label)+" ")]),l("div",{directives:[{name:"show",rawName:"v-show",value:e.showColumns,expression:"item.showColumns"}]},t._l(e.columns,(function(e){return l("div",{staticClass:"column"},[l("span",{staticClass:"columnName"},[t._v(t._s(e.label))]),l("span",{staticClass:"columnType"},[t._v(t._s(e.TypeName))])])})),0)])])})),0)]),l("div",{staticClass:"right"},[l("div",{staticClass:"top"},[l("div",{staticClass:"tool"},[l("div",{directives:[{name:"show",rawName:"v-show",value:t.isFullScreen,expression:"isFullScreen"}]},[l("div",{staticClass:"item",on:{click:function(e){return t.run(!1)}}},[l("i",{staticClass:"iconfont icon-play"}),l("span",[t._v("运行SQL")])]),l("div",{staticClass:"item",on:{click:function(e){return t.run(!0)}}},[l("i",{staticClass:"iconfont icon-play"}),l("span",[t._v("运行选中SQL")])]),l("div",{staticClass:"item",on:{click:t.parseSql}},[l("i",{staticClass:"iconfont icon-play"}),l("span",[t._v("解析动态SQL")])]),l("div",{staticClass:"item",on:{click:t.formatSql}},[l("i",{staticClass:"iconfont icon-play"}),l("span",[t._v("格式化SQL")])])])]),l("div",{staticClass:"quick"},[l("div",{staticClass:"tag",on:{click:function(e){return t.tag("foreach")}}},[t._v("foreach")]),l("div",{staticClass:"tag",on:{click:function(e){return t.tag("if")}}},[t._v("if")]),l("div",{staticClass:"tag",on:{click:function(e){return t.tag("where")}}},[t._v("where")]),l("div",{staticClass:"tag",on:{click:function(e){return t.tag("trim")}}},[t._v("trim")]),"mini"==t.mode?l("i",{staticClass:"iconfont icon-full",on:{click:t.fullWindow}}):t._e(),"large"==t.mode?l("i",{staticClass:"iconfont icon-mini2",on:{click:t.miniWindow}}):t._e()])]),l("div",{staticClass:"code"},[l("div",{staticClass:"multi-sql"},[t._l(this.$store.state.sqls,(function(e,s){return l("code-ui",{directives:[{name:"show",rawName:"v-show",value:t.currentIndex===s,expression:"currentIndex === index"}],key:e.id,ref:"codeui-"+s,refInFor:!0,attrs:{sql:e.sqlText,mode:t.mode,tableHints:t.tableHints},on:{appendCm:t.appendCm}})})),l("div",{staticClass:"tabs"},[t._l(this.$store.state.sqls,(function(e,s){return l("div",{class:{tab:!0,"tab-active":t.currentIndex===s}},[l("div",{staticClass:"text",on:{click:function(e){return t.focusCM(s)}}},[t._v("SQL-"+t._s(e.id))]),s>0?l("span",{staticClass:"el-icon-circle-close close",on:{click:function(e){return t.removeTab(s)}}}):t._e()])})),l("div",{staticClass:"tab",on:{click:t.addTab}},[t._m(0)])],2)],2),l("div",{staticClass:"params"},[l("div",{staticStyle:{display:"inline-block"}},[t._v("参数设置：")]),l("el-tooltip",{attrs:{placement:"top-start",effect:"dark"}},[l("div",{attrs:{slot:"content"},slot:"content"},[t._v("填写sql运行需要的参数值，拼接成json格式")]),l("i",{staticClass:"el-icon-info tip",staticStyle:{color:"#ccc"}})]),l("el-input",{attrs:{type:"textarea",rows:"24"},on:{input:function(e){return t.input(e)}},model:{value:t.params,callback:function(e){t.params=e},expression:"params"}}),l("el-button",{attrs:{size:"mini"},on:{click:t.formatJson}},[t._v("json格式化")])],1)]),l("div",{staticClass:"result"},[null!=t.error?l("div",{staticClass:"error"},[l("i",{staticClass:"el-icon-error"}),t._v(" "+t._s(t.error)+" ")]):t._e(),null!=t.updateMsg?l("div",{staticClass:"updateMsg"},[l("i",{staticClass:"el-icon-success"}),t._v(" "+t._s(t.updateMsg)+" ")]):t._e(),null!=t.sqlMeta?l("div",{staticClass:"sqlMeta"},[l("div",{staticClass:"sql"},[t._v(t._s(t.sqlMeta.sql))]),l("div",{staticClass:"sql"},[t._v(t._s(t.sqlMeta.jdbcParamValues))])]):t._e(),l("div",{staticClass:"table"},[null!=t.resultList&&t.resultList.length>0?l("el-table",{staticStyle:{width:"100%"},attrs:{data:t.resultList,border:"",stripe:"",size:"mini"}},t._l(Object.keys(t.resultList[0]),(function(t){return l("el-table-column",{attrs:{prop:t,label:t}})})),1):t._e(),null!=t.resultList&&0==t.resultList.length?l("div",[t._v(" 查询结果为空 ")]):t._e()],1)])])])}),n=[function(){var t=this,e=t.$createElement,l=t._self._c||e;return l("div",{staticClass:"text"},[l("i",{staticClass:"el-icon-circle-plus"}),t._v(" 添加 ")])}],r=(l("e9c4"),l("ac1f"),l("5319"),l("498a"),function(){var t=this,e=t.$createElement,l=t._self._c||e;return l("div",[l("codemirror",{staticClass:"myMirror",attrs:{options:t.cmOptions},on:{ready:t.onCmReady,focus:t.onCmFocus,inputRead:t.onCmCodeChange}})],1)}),o=[],c=(l("00b4"),l("8f94"));l("8c06"),l("b866"),l("7ba3"),l("f6b6"),l("ffda");l("56b3"),l("ffda"),l("9b74"),l("991c");var u={name:"codeUI",components:{codemirror:c["codemirror"]},data:function(){return{cmInstance:null,cmOptions:{value:"",styleActiveLine:!0,lineNumbers:!0,mode:"text/x-mysql",theme:"idea",lint:!0,matchBrackets:!0,extraKeys:{Tab:"autocomplete"},hintOptions:{completeSingle:!1,tables:{}}}}},props:{sql:{type:String,default:""},mode:{type:String,default:"mini"},tableHints:{type:Object}},methods:{onCmReady:function(t){t.setValue(this.sql),this.cmInstance=t,this.$emit("appendCm",t),"mini"===this.mode?t.setSize("100%","400px"):t.setSize("100%","calc(100vh - 350px)")},onCmFocus:function(t){},onCmCodeChange:function(t,e){/^[a-zA-Z.]/.test(e.text[0])&&t.showHint()}},watch:{mode:function(t,e){"mini"===t?this.cmInstance.setSize("100%","400px"):this.cmInstance.setSize("100%","calc(100vh - 350px)")},tableHints:function(t,e){this.cmOptions.hintOptions.tables=t}},created:function(){this.cmOptions.hintOptions.tables=this.tableHints}},d=u,m=(l("77db"),l("2877")),p=Object(m["a"])(d,r,o,!1,null,"4a30beae",null),f=p.exports,h=l("db05"),b={data:function(){return{resultList:null,error:null,updateMsg:null,isFullScreen:!1,mode:"mini",params:"{}",datasourceId:null,datasources:[],tables:[],table:null,currentIndex:0,sqlMeta:null,tableHints:{}}},props:{apiSql:{type:Array,default:function(){return[{sqlText:"",transformPlugin:null,transformPluginParams:null}]}}},components:{codeUi:f},methods:{appendCm:function(t){this.$store.commit("addCm",t)},addTab:function(){this.$store.commit("addSql"),this.currentIndex=this.$store.state.sqls.length-1},formatJson:function(){var t=JSON.parse(this.params);this.params=JSON.stringify(t,null,4)},input:function(t){console.log(t)},parseSql:function(){this.resultList=null,this.updateMsg=null,this.error=null,this.sqlMeta=null},formatSql:function(){var t=Object(h["format"])(this.$store.getters.currentCm(this.currentIndex).getValue()).replace(/# /g,"#").replace(/{ /g,"{").replace(/ }/g,"}").replace(/< foreach/g,"\n<foreach\n").replace(/< \/ foreach >/g,"\n</foreach>\n").replace(/< if/g,"\n<if").replace(/< \/ if >/g,"\n</if>\n").replace(/<\nwhere\n  >/g,"\n<where>\n").replace(/< \/\nwhere\n  >/g,"\n</where>\n").replace(/< trim/g,"\n<trim").replace(/< \/ trim >/g,"\n</trim>\n");this.$store.getters.currentCm(this.currentIndex).setValue(t)},run:function(t){var e;null!=this.datasourceId?(e=t?this.$store.getters.currentCm(this.currentIndex).getSelection():this.$store.getters.currentCm(this.currentIndex).getValue(),null!=e&&""!=e.trim()?(this.resultList=null,this.updateMsg=null,this.error=null,this.sqlMeta=null):this.$message.error("请先输入sql")):this.$message.error("请先选择数据源")},fullWindow:function(){this.mode="large",this.isFullScreen=!0},miniWindow:function(){this.mode="mini",this.isFullScreen=!1},getColumns:function(t,e){0==this.tables[e].columns.length||(this.tables[e].showColumns=!this.tables[e].showColumns)},getAllSource:function(){},getTables:function(t){},removeTab:function(t){this.$store.commit("removeSql",t),t<=this.currentIndex&&(this.currentIndex-=1)},focusCM:function(t){this.currentIndex=t},tag:function(t){var e="";"foreach"==t?e='\n<foreach open="(" close=")" collection="" separator="," item="item" index="index">#{item}</foreach>':"if"==t?e='\n<if test="" ></if>':"where"==t?e="\n<where></where>":"trim"==t&&(e='\n<trim prefix="" suffix="" suffixesToOverride="" prefixesToOverride=""></trim>'),this.$store.getters.currentCm(this.currentIndex).setValue(this.$store.getters.currentCm(this.currentIndex).getValue()+e)}},created:function(){this.getAllSource()},watch:{apiSql:function(t,e){this.$store.commit("initSqls",this.apiSql)}}},v=b,g=(l("6819"),Object(m["a"])(v,i,n,!1,null,"299ae86e",null)),C=g.exports,x={data:function(){return{datasources:[],address:null,show:!1,groups:[{label:"姓名",value:"name"}],dialogVisible:!1,detail:{name:null,note:null,path:null,params:[],groupId:null,previlege:0,cachePlugin:null,cachePluginParams:null,sqlList:[{sqlText:"",transformPlugin:null,transformPluginParams:null}]},options:[{label:"string",value:"string"},{label:"bigint",value:"bigint"},{label:"double",value:"double"},{label:"date",value:"date"},{label:"string 数组",value:"Array<string>"},{label:"bigint 数组",value:"Array<bigint>"},{label:"double 数组",value:"Array<double>"},{label:"date 数组",value:"Array<date>"}],table:null,tables:[],columns:[],column:null,isFullScreen:!1,mode:"mini"}},props:["id"],methods:{addRow:function(){this.detail.params.push({name:null,type:null})},deleteRow:function(t){this.detail.params.splice(t,1)},parseParams:function(t,e){},getAddress:function(){},getDetail:function(t){this.id=t},getAllGroups:function(){}},mounted:function(){console.log("mount----+++"),this.getAddress(),void 0!=this.id?(console.log("edit api page"),this.getDetail(this.id)):(console.log("add api page"),this.$store.commit("initSqls",[{sqlText:"-- 请输入sql",transformPlugin:null,transformPluginParams:null}])),this.getAllGroups()},components:{sqlCode:C}},_=x,w=(l("92ac"),Object(m["a"])(_,s,a,!1,null,"78869f3d",null));e["a"]=w.exports}}]);